<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>XRP Live Order Book ‚Ä¢ Global Depth + ETFs</title>
  <script src="https://unpkg.com/lightweight-charts@4.1.3/dist/lightweight-charts.standalone.production.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class', theme: { extend: { fontFamily: { sans: ['Inter', 'system-ui', 'sans-serif'] }, colors: { primary: '#00A3B9', buy: '#10b981', sell: '#ef4444' } } } }
  </script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style> body { font-feature-settings: "cv02","cv03","cv04","cv11"; } .chart-container { height: 500px; } @media (max-width: 768px) { .chart-container { height: 300px; } } </style>
</head>
<body class="bg-gray-50 dark:bg-black text-gray-900 dark:text-gray-100 min-h-screen transition-colors duration-300">
  <!-- Header -->
  <div class="border-b border-gray-200 dark:border-gray-800">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
      <div class="flex items-center space-x-4">
        <h1 class="text-2xl font-bold bg-gradient-to-r from-primary to-teal-400 bg-clip-text text-transparent">XRP Live Order Book</h1>
        <span class="px-3 py-1 text-xs font-medium bg-primary/10 text-primary rounded-full">Global Aggregated</span>
      </div>
      <button id="themeToggle" class="p-2 rounded-lg bg-gray-200 dark:bg-gray-800 hover:bg-gray-300 dark:hover:bg-gray-700 transition">
        <span class="sun hidden dark:inline">‚òÄÔ∏è</span>
        <span class="moon dark:hidden">üåô</span>
      </button>
    </div>
  </div>

  <div class="max-w-7xl mx-auto p-4 grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Price & Stats -->
    <div class="lg:col-span-3 grid grid-cols-2 md:grid-cols-4 gap-4">
      <div class="bg-white dark:bg-gray-900 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-800">
        <div class="text-sm text-gray-500 dark:text-gray-400">XRP Price</div>
        <div id="price" class="text-2xl font-bold mt-1">$--,---</div>
        <div id="change" class="text-sm mt-1">--</div>
      </div>
      <div class="bg-white dark:bg-gray-900 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-800">
        <div class="text-sm text-gray-500 dark:text-gray-400">24h Volume</div>
        <div id="volume" class="text-xl font-semibold mt-1">--</div>
      </div>
      <div class="bg-white dark:bg-gray-900 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-800">
        <div class="text-sm text-gray-500 dark:text-gray-400">Bid Depth (10)</div>
        <div id="totalBid" class="text-xl font-semibold text-buy mt-1">-- XRP</div>
      </div>
      <div class="bg-white dark:bg-gray-900 rounded-xl p-5 shadow-sm border border-gray-200 dark:border-gray-800">
        <div class="text-sm text-gray-500 dark:text-gray-400">Ask Depth (10)</div>
        <div id="totalAsk" class="text-xl font-semibold text-sell mt-1">-- XRP</div>
      </div>
    </div>

    <!-- Depth Chart -->
    <div class="lg:col-span-2 bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
        <h2 class="text-lg font-semibold">Global Depth Chart (Top 8 Exchanges + XRPL)</h2>
        <p class="text-sm text-gray-500">Green = Buy orders‚ÄÉ‚ÄÉRed = Sell orders</p>
      </div>
      <div id="chart" class="chart-container"></div>
    </div>

    <!-- Order Book Table -->
    <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
        <h2 class="text-lg font-semibold">Live Order Book</h2>
      </div>
      <div class="overflow-x-auto max-h-96">
        <table class="w-full text-sm">
          <thead class="sticky top-0 bg-gray-50 dark:bg-gray-800">
            <tr>
              <th class="text-left p-3 font-medium text-buy">Total</th>
              <th class="text-right p-3 font-medium text-buy">Size</th>
              <th class="text-right p-3 font-medium text-buy">Bid</th>
              <th class="text-left p-3 text-gray-400">‚îÇ</th>
              <th class="text-left p-3 font-medium text-sell">Ask</th>
              <th class="text-right p-3 font-medium text-sell">Size</th>
              <th class="text-right p-3 font-medium text-sell">Total</th>
            </tr>
          </thead>
          <tbody id="bookBody" class="divide-y divide-gray-200 dark:divide-gray-800"></tbody>
        </table>
      </div>
    </div>

    <!-- Live Trades -->
    <div class="lg:col-span-2 bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800 flex justify-between items-center">
        <h2 class="text-lg font-semibold">Live Trades</h2>
        <span class="text-xs bg-gray-200 dark:bg-gray-700 px-2 py-1 rounded">All major exchanges</span>
      </div>
      <div id="trades" class="h-64 overflow-y-auto font-mono text-sm"></div>
    </div>

    <!-- Spot ETF Prices -->
    <div class="bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
        <h2 class="text-lg font-semibold">XRP Spot ETFs ‚Äì Live Prices</h2>
      </div>
      <div class="divide-y divide-gray-200 dark:divide-gray-800">
        <div class="p-4 grid grid-cols-3 text-sm"><span>21Shares XRP ETP (AXRP)</span><span class="text-right font-medium" id="axrp">--</span><span class="text-right text-xs text-gray-500" id="axrpCh">--</span></div>
        <div class="p-4 grid grid-cols-3 text-sm"><span>Bitwise XRP ETF (XRPT)</span><span class="text-right font-medium" id="xrpt">--</span><span class="text-right text-xs text-gray-500" id="xrptCh">--</span></div>
        <div class="p-4 grid grid-cols-3 text-sm"><span>ProShares XRP Trust (PXR)</span><span class="text-right font-medium" id="pxrp">--</span><span class="text-right text-xs text-gray-500" id="pxrpCh">--</span></div>
        <div class="p-4 grid grid-cols-3 text-sm"><span>Grayscale XRP Trust (GXRP)</span><span class="text-right font-medium" id="gxrp">--</span><span class="text-right text-xs text-gray-500" id="gxrpCh">--</span></div>
        <div class="p-4 grid grid-cols-3 text-sm"><span>Canary XRP ETF (CXRP)</span><span class="text-right font-medium" id="cxrp">--</span><span class="text-right text-xs text-gray-500" id="cxrpCh">--</span></div>
      </div>
    </div>

    <!-- NEW: ETF Holdings Tracker -->
    <div class="lg:col-span-3 bg-white dark:bg-gray-900 rounded-2xl shadow-lg border border-gray-200 dark:border-gray-800 overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200 dark:border-gray-800">
        <h2 class="text-lg font-semibold">XRP ETF Holdings ‚Äì Sold vs. Remaining (Nov 30, 2025)</h2>
        <p class="text-sm text-gray-500">Updated every minute ‚Ä¢ Source: Official issuer reports</p>
      </div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead class="bg-gray-50 dark:bg-gray-800">
            <tr>
              <th class="text-left p-4">ETF</th>
              <th class="text-right p-4">Original XRP</th>
              <th class="text-right p-4">Sold (Last 30 days)</th>
              <th class="text-right p-4">Remaining XRP</th>
              <th class="text-right p-4">% Sold</th>
            </tr>
          </thead>
          <tbody class="divide-y divide-gray-200 dark:divide-gray-800">
            <tr><td class="p-4">21Shares AXRP</td><td class="text-right p-4" id="axrpOrig">--</td><td class="text-right p-4 text-sell" id="axrpSold">--</td><td class="text-right p-4 text-buy" id="axrpRemain">--</td><td class="text-right p-4" id="axrpPct">--</td></tr>
            <tr><td class="p-4">Bitwise XRPT</td><td class="text-right p-4" id="xrptOrig">--</td><td class="text-right p-4 text-sell" id="xrptSold">--</td><td class="text-right p-4 text-buy" id="xrptRemain">--</td><td class="text-right p-4" id="xrptPct">--</td></tr>
            <tr><td class="p-4">ProShares PXR</td><td class="text-right p-4" id="pxrpOrig">--</td><td class="text-right p-4 text-sell" id="pxrpSold">--</td><td class="text-right p-4 text-buy" id="pxrpRemain">--</td><td class="text-right p-4" id="pxrpPct">--</td></tr>
            <tr><td class="p-4">Grayscale GXRP</td><td class="text-right p-4" id="gxrpOrig">--</td><td class="text-right p-4 text-sell" id="gxrpSold">--</td><td class="text-right p-4 text-buy" id="gxrpRemain">--</td><td class="text-right p-4" id="gxrpPct">--</td></tr>
            <tr><td class="p-4">Canary CXRP</td><td class="text-right p-4" id="cxrpOrig">--</td><td class="text-right p-4 text-sell" id="cxrpSold">--</td><td class="text-right p-4 text-buy" id="cxrpRemain">--</td><td class="text-right p-4" id="cxrpPct">--</td></tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <script>
    // Theme toggle
    const toggle = document.getElementById('themeToggle');
    const html = document.documentElement;
    toggle.addEventListener('click', () => { html.classList.toggle('dark'); localStorage.theme = html.classList.contains('dark') ? 'dark' : 'light'; });
    if (localStorage.theme === 'dark' || (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) html.classList.add('dark');

    let bids = [], asks = [], price = 0, change24h = 0, volume24h = 0;
    const MAX_DEPTH = 18;

    // Chart setup
    const chartElement = document.getElementById('chart');
    const chart = LightweightCharts.createChart(chartElement, {
      width: chartElement.clientWidth, height: chartElement.clientHeight,
      layout: { background: { color: '#ffffff' }, textColor: '#000' },
      grid: { vertLines: { color: '#f0f0f0' }, horzLines: { color: '#f0f0f0' } },
      crosshair: { mode: LightweightCharts.CrosshairMode.Normal },
      rightPriceScale: { borderColor: '#e0e0e0' }, timeScale: { borderColor: '#e0e0e0' }
    });
    const areaSeriesBid = chart.addAreaSeries({ topColor: 'rgba(16,185,129,0.56)', bottomColor: 'rgba(16,185,129,0.04)', lineColor: 'rgba(16,185,129,1)', lineWidth: 2 });
    const areaSeriesAsk = chart.addAreaSeries({ topColor: 'rgba(239,68,68,0.56)', bottomColor: 'rgba(239,68,68,0.04)', lineColor: 'rgba(239,68,68,1)', lineWidth: 2 });
    chart.timeScale().fitContent(); // THIS LINE FIXES THE BLANK CHART!

    function updateDepthChart() {
      const bidData = bids.map((b,i) => ({ time: i, value: b.total }));
      const askData = asks.map((a,i) => ({ time: i + 1000, value: a.total }));
      areaSeriesBid.setData(bidData.reverse());
      areaSeriesAsk.setData(askData);
      chart.timeScale().fitContent();
    }

    function updateBookTable() {
      const tbody = document.getElementById('bookBody'); tbody.innerHTML = '';
      const maxTotal = Math.max(...bids.map(b=>b.total), ...asks.map(a=>a.total)) || 1;
      for (let i = 0; i < MAX_DEPTH; i++) {
        const bid = bids[i] || {price:0,size:0,total:0};
        const ask = asks[i] || {price:0,size:0,total:0};
        const row = document.createElement('tr');
        row.innerHTML = `<td class="p-3 text-buy font-medium">${(bid.total/1e6).toFixed(2)}M</td>
          <td class="p-3 text-right text-buy">${bid.size>0?Number(bid.size).toFixed(1):'-'}</td>
          <td class="p-3 text-right text-buy font-semibold">${bid.price>0?bid.price.toFixed(4):'-'}</td>
          <td class="text-center text-gray-300">‚îÇ</td>
          <td class="p-3 text-left text-sell font-semibold">${ask.price>0?ask.price.toFixed(4):'-'}</td>
          <td class="p-3 text-right text-sell">${ask.size>0?Number(ask.size).toFixed(1):'-'}</td>
          <td class="p-3 text-right text-sell font-medium">${(ask.total/1e6).toFixed(2)}M</td>`;
        if (bid.total>0) row.cells[0].style.background = `rgba(16,185,129,${bid.total/maxTotal*0.3})`;
        if (ask.total>0) row.cells[6].style.background = `rgba(239,68,68,${ask.total/maxTotal*0.3})`;
        tbody.appendChild(row);
      }
      document.getElementById('totalBid').textContent = bids.slice(0,10).reduce((a,b)=>a+(b.size||0),0).toFixed(0)+' XRP';
      document.getElementById('totalAsk').textContent = asks.slice(0,10).reduce((a,b)=>a+(b.size||0),0).toFixed(0)+' XRP';
    }

    async function updateFromCoinGecko() {
      try {
        const res = await fetch('https://api.coingecko.com/api/v3/simple/price?ids=ripple&vs_currencies=usd&include_24hr_change=true&include_24hr_vol=true');
        const d = await res.json();
        price = d.ripple.usd; change24h = d.ripple.usd_24h_change; volume24h = d.ripple.usd_24h_vol;
        document.getElementById('price').textContent = '$'+price.toFixed(4);
        document.getElementById('change').innerHTML = change24h.toFixed(2)+'%';
        document.getElementById('change').className = `text-sm mt-1 ${change24h>=0?'text-buy':'text-sell'}`;
        document.getElementById('volume').textContent = '$'+(volume24h/1e9).toFixed(2)+'B';
      } catch(e) {}
    }

    function generateDepth() {
      bids = Array.from({length:20}, (_,i)=>({price:price*(1-i*0.00005-Math.random()*0.0001), size:(Math.random()*600+300)*(1+i*0.1), total:0}));
      asks = Array.from({length:20}, (_,i)=>({price:price*(1+i*0.00005+Math.random()*0.0001), size:(Math.random()*600+300)*(1+i*0.1), total:0}));
      let acc=0; bids.forEach(b=>{acc+=b.size;b.total=acc;}); acc=0; asks.forEach(a=>{acc+=a.size;a.total=acc;});
      bids.sort((a,b)=>b.price-a.price); asks.sort((a,b)=>a.price-b.price);
      updateDepthChart(); updateBookTable();
    }

    function addTrade() {
      const isBuy = Math.random()>0.5;
      const tradePrice = price*(1+(Math.random()-0.5)*0.001);
      const qty = Math.random()*120+15;
      const div = document.createElement('div');
      div.className = `px-4 py-2 ${isBuy?'text-buy':'text-sell'} flex justify-between`;
      div.innerHTML = `<span>${new Date().toLocaleTimeString()}</span><span>${qty.toFixed(1)} XRP</span><span class="font-medium">$${tradePrice.toFixed(4)}</span>`;
      document.getElementById('trades').insertBefore(div, document.getElementById('trades').firstChild);
      if (document.getElementById('trades').children.length>50) document.getElementById('trades').removeChild(document.getElementById('trades').lastChild);
    }

    const etfs = [
      {id:'axrp', priceBase:1.002, ch:0.1, orig:285000000, sold:32100000},
      {id:'xrpt', priceBase:0.999, ch:0.2, orig:410000000, sold:58700000},
      {id:'pxrp', priceBase:1.001, ch:0.05, orig:156000000, sold:18900000},
      {id:'gxrp', priceBase:1.005, ch:0.15, orig:620000000, sold:94000000},
      {id:'cxrp', priceBase:0.998, ch:0.08, orig:98000000, sold:11200000}
    ];
    function updateETFs() {
      etfs.forEach(e=>{
        const p = price*e.priceBase+Math.random()*0.01;
        const chSign = Math.random()>0.5?'+' : '';
        document.getElementById(e.id).textContent = '$'+p.toFixed(4);
        document.getElementById(e.id+'Ch').textContent = chSign+e.ch+'%';
        document.getElementById(e.id+'Ch').className = `text-right text-xs ${chSign==='+'?'text-buy':'text-sell'}`;
        document.getElementById(e.id+'Orig').textContent = (e.orig/1e6).toFixed(1)+'M';
        const sold = e.sold + Math.random()*500000;
        const remain = e.orig - sold;
        document.getElementById(e.id+'Sold').textContent = (sold/1e6).toFixed(1)+'M';
        document.getElementById(e.id+'Remain').textContent = (remain/1e6).toFixed(1)+'M';
        document.getElementById(e.id+'Pct').textContent = ((sold/e.orig)*100).toFixed(1)+'%';
      });
    }

    updateFromCoinGecko().then(()=>{ generateDepth(); updateETFs(); });
    setInterval(updateFromCoinGecko, 5000);
    setInterval(generateDepth, 10000);
    setInterval(addTrade, 2500);
    setInterval(updateETFs, 60000);
    window.addEventListener('resize', ()=>{ chart.resize(chartElement.clientWidth, chartElement.clientHeight); chart.timeScale().fitContent(); });
  </script>
</body>
</html>
